<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…ç´šå¤§é…·ç‚«æ‰£è€ƒç¥å™¨ Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- ç²‰ç´…ç³»ä¸»é¡Œè‰² --- */
            --bg: #FFF0F5; /* æ·ºç²‰èƒŒæ™¯ */
            --surface: #FFFFFF;
            --primary: #FF8BA7; /* ä¸»è‰²èª¿ï¼šçŠç‘šç²‰ */
            --primary-dark: #FF6B8B;
            --text-main: #5D4E52; /* æ·±æš–ç°å­—é«” */
            --text-sub: #A39498;
            
            /* --- ç‹€æ…‹è‰² (æŸ”å’Œç‰ˆ) --- */
            --safe-bg: #E8FDF5; --safe-text: #10B981;
            --warn-bg: #FFF4E6; --warn-text: #F59E0B;
            --danger-bg: #FFEBEB; --danger-text: #FF4757;

            /* --- é€²åº¦æ¢æ¼¸å±¤ --- */
            --sick-grad: linear-gradient(135deg, #E0C3FC 0%, #C084FC 100%);
            --mens-grad: linear-gradient(135deg, #FFB6B9 0%, #FF6B6B 100%);
        }

        body {
            /* é€™è£¡æ›æˆäº†åœ“é«” */
            font-family: 'Zen Maru Gothic', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            background-image: radial-gradient(#ffe4e9 10%, transparent 10%);
            background-size: 20px 20px;
        }

        .app-wrapper { width: 100%; max-width: 500px; padding-bottom: 50px; }

        /* Header */
        header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 28px; font-weight: 900; letter-spacing: 1px; color: var(--primary-dark); }
        
        /* å‰¯æ¨™é¡Œç‰¹åˆ¥æ¨£å¼ */
        p.subtitle { 
            margin: 8px 0 0; 
            font-size: 16px; 
            font-weight: 900; 
            color: var(--primary);
            background: #fff;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(255, 139, 167, 0.1);
        }

        /* Add Form */
        .add-card {
            background: var(--surface); padding: 15px; border-radius: 20px;
            box-shadow: 0 8px 20px rgba(255, 139, 167, 0.15); display: flex; gap: 10px; margin-bottom: 25px;
            border: 2px solid #FFE4E9;
        }
        input, select { 
            padding: 12px 16px; border: 2px solid #F0E4E8; border-radius: 16px; 
            outline: none; background: #FFFBFC; width: 100%; font-size: 15px; color: var(--text-main);
            transition: 0.2s;
            font-family: 'Zen Maru Gothic', sans-serif; /* è¼¸å…¥æ¡†ä¹Ÿè¦åœ“åœ“çš„ */
            font-weight: 700;
        }
        input:focus, select:focus { border-color: var(--primary); background: #fff; }
        
        .btn-add {
            background: var(--primary); color: white; border: none; border-radius: 16px;
            width: 54px; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; box-shadow: 0 4px 10px rgba(255, 139, 167, 0.3);
        }
        .btn-add:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-add:active { transform: scale(0.95); }

        /* Course Card */
        .course-card {
            background: var(--surface); border-radius: 24px; padding: 24px;
            margin-bottom: 24px; box-shadow: 0 8px 25px rgba(255, 139, 167, 0.1); position: relative;
            border: 1px solid #FFF0F5;
        }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 18px; }
        .c-name { font-size: 20px; font-weight: 900; display: flex; align-items: center; gap: 8px; letter-spacing: 1px; }
        .c-meta { font-size: 13px; color: var(--text-sub); margin-top: 4px; margin-left: 32px; font-weight: 700; }
        .btn-del { background: none; border: none; color: #E0D4D8; font-size: 20px; cursor: pointer; transition: 0.2s; }
        .btn-del:hover { color: var(--danger-text); transform: scale(1.1); }

        /* Dashboard */
        .dashboard {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            background: #FFFBFC; padding: 12px; border-radius: 18px; margin-bottom: 24px;
            border: 2px solid #F8F0F4;
        }
        .dash-item { text-align: center; font-size: 13px; font-weight: 700; display: flex; flex-direction: column; gap: 6px; color: var(--text-sub); }
        .badge { padding: 6px 12px; border-radius: 12px; font-weight: 900; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 4px;}
        .safe { background: var(--safe-bg); color: var(--safe-text); }
        .warn { background: var(--warn-bg); color: var(--warn-text); }
        .danger { background: var(--danger-bg); color: var(--danger-text); }

        /* Progress Bar */
        .progress-track {
            height: 18px; background: #F0E4E8; border-radius: 9px; position: relative; margin-bottom: 24px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .bar-seg { height: 100%; float: left; transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; }
        .b-sick { background: var(--sick-grad); border-radius: 9px 0 0 9px; z-index: 2; }
        .b-mens { background: var(--mens-grad); border-radius: 0 9px 9px 0; z-index: 1; }
        .rounded { border-radius: 9px !important; }

        .limit-mark {
            position: absolute; top: -6px; bottom: -6px; width: 3px; background: var(--text-main); z-index: 10;
            border-radius: 2px; border: 2px solid white;
        }
        .limit-txt {
            position: absolute; top: -28px; left: 50%; transform: translateX(-50%);
            font-size: 11px; font-weight: 900; background: var(--surface); padding: 3px 8px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08); color: var(--primary-dark);
        }

        /* Controls */
        .controls { display: flex; gap: 12px; }
        .ctrl-group {
            flex: 1; background: #FFFBFC; padding: 10px 12px; border-radius: 18px;
            display: flex; justify-content: space-between; align-items: center; border: 2px solid #F8F0F4;
        }
        .ctrl-label { font-size: 12px; font-weight: 900; color: var(--text-sub); display: flex; align-items: center; gap: 4px; }
        .val { font-size: 20px; font-weight: 900; }
        .v-sick { color: #C084FC; } .v-mens { color: #FF6B6B; }
        
        .btn-act {
            border: none; cursor: pointer; font-weight: 900; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
            font-family: 'Zen Maru Gothic', sans-serif;
        }
        .btn-m { background: transparent; color: #C0B4B8; width: 28px; font-size: 20px; }
        .btn-m:hover { color: var(--primary); background: #FFF0F5; }
        .btn-p { background: white; color: var(--text-main); width: 38px; height: 38px; border: 2px solid #F0E4E8; box-shadow: 0 4px 8px rgba(0,0,0,0.05); font-size: 15px; }
        .btn-p:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); box-shadow: 0 6px 12px rgba(255, 139, 167, 0.2); }
        .btn-p:active { transform: scale(0.95); }

        /* Data Sync Section */
        .sync-section {
            margin-top: 40px; padding: 25px; background: #fff; border-radius: 24px; text-align: center;
            border: 3px dashed #FFC4D0; background: #FFF9FA;
        }
        .sync-btn {
            background: var(--text-main); color: white; border: none; padding: 12px 24px; border-radius: 12px; 
            font-size: 15px; cursor: pointer; margin: 8px; font-weight: 900; transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: inline-flex; align-items: center; gap: 8px;
            font-family: 'Zen Maru Gothic', sans-serif;
        }
        .sync-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .sync-btn:active { transform: scale(0.95); }
        .sync-btn.import { background: var(--primary); }
        .sync-btn.import:hover { background: var(--primary-dark); box-shadow: 0 6px 15px rgba(255, 139, 167, 0.3); }
    </style>
</head>
<body>

<div class="app-wrapper">
    <header>
        <h1>âœ¨ è¶…ç´šå¤§é…·ç‚«<br>æ‰£è€ƒç¥å™¨ <span style="color:var(--primary)">Pro</span> ğŸŒ¸</h1>
        <p class="subtitle">ğŸ¥º æˆ‘ä¸è¦æ‰£è€ƒ ğŸ¥º</p>
    </header>

    <div class="add-card">
        <input type="text" id="name" placeholder="ğŸ“ è¼¸å…¥èª²ç¨‹åç¨±..." style="flex:2">
        <select id="weekly" style="flex:1">
            <option value="1">ğŸ“… 1ç¯€/é€±</option>
            <option value="2" selected>ğŸ“… 2ç¯€/é€±</option>
            <option value="3">ğŸ“… 3ç¯€/é€±</option>
            <option value="4">ğŸ“… 4ç¯€/é€±</option>
        </select>
        <button class="btn-add" onclick="add()">âœ¨</button>
    </div>

    <div id="list"></div>

    <div class="sync-section">
        <h3 style="margin:0 0 10px 0; color:var(--primary-dark); font-weight:900;">â˜ï¸ è·¨è£ç½®é›²ç«¯å‚³é€é–€</h3>
        <p style="font-size:13px; color:var(--text-sub); margin-bottom:20px; font-weight:700;">
            æ›æ‰‹æ©Ÿäº†å—ï¼Ÿç”¨é€™è£¡æŠŠè³‡æ–™æ‰“åŒ…å¸¶èµ°ï¼ğŸ“¦<br>
            (ä¸åŒè£ç½®è³‡æ–™ä¸äº’é€šå–”)
        </p>
        <button class="sync-btn" onclick="exportData()">ğŸ“¤ æ‰“åŒ…è³‡æ–™</button>
        <button class="sync-btn import" onclick="importData()">ğŸ“¥ è§£å£“ç¸®</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", render);

    function getData() { return JSON.parse(localStorage.getItem("ck_final")) || []; }
    function saveData(d) { localStorage.setItem("ck_final", JSON.stringify(d)); }

    function add() {
        let name = document.getElementById('name').value.trim();
        let weekly = parseInt(document.getElementById('weekly').value);
        if(!name) return;
        let total = weekly * 18;
        let data = getData();
        data.push({ id: Date.now(), name, total, limit: Math.ceil(total/3), sick:0, mens:0 });
        saveData(data);
        document.getElementById('name').value = '';
        render();
    }

    function update(id, type, val) {
        let data = getData();
        let item = data.find(x => x.id === id);
        if(item) {
            if(type==='sick') item.sick = Math.max(0, item.sick+val);
            if(type==='mens') item.mens = Math.max(0, item.mens+val);
            saveData(data);
            render();
        }
    }

    function del(id) {
        if(confirm("ğŸ—‘ï¸ ç¢ºå®šè¦åˆªé™¤é€™å ‚èª²çš„ç´€éŒ„å—ï¼Ÿ")) { saveData(getData().filter(x=>x.id!==id)); render(); }
    }

    // --- è½‰ç§»åŠŸèƒ½ ---
    function exportData() {
        let data = localStorage.getItem("ck_final");
        if(!data || data === "[]") return alert("ğŸ“­ ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥æ‰“åŒ…å–”ï¼");
        let code = btoa(encodeURIComponent(data));
        navigator.clipboard.writeText(code).then(() => {
            alert("âœ… ä»£ç¢¼å·²è¤‡è£½ï¼\nè«‹è²¼åˆ°å¦ä¸€å°è£ç½®çš„ã€ŒğŸ“¥ è§£å£“ç¸®ã€è£¡ã€‚");
        }).catch(() => {
            prompt("ğŸ‘‡ è«‹æ‰‹å‹•è¤‡è£½é€™ä¸²ä»£ç¢¼ ğŸ‘‡", code);
        });
    }

    function importData() {
        let code = prompt("ğŸ‘‡ è«‹è²¼ä¸Šä¾†è‡ªå¦ä¸€å°è£ç½®çš„ä»£ç¢¼ ğŸ‘‡");
        if(!code) return;
        try {
            let json = decodeURIComponent(atob(code));
            if(confirm("âš ï¸ æ³¨æ„ï¼\nåŒ¯å…¥å°‡æœƒã€Œè¦†è“‹ã€ç›®å‰æ‰‹æ©Ÿä¸Šçš„æ‰€æœ‰ç´€éŒ„ã€‚\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")) {
                localStorage.setItem("ck_final", json);
                render();
                alert("ğŸ‰ æˆåŠŸï¼è³‡æ–™è½‰ç§»å®Œæˆï¼");
            }
        } catch(e) {
            alert("âŒ ä»£ç¢¼æ ¼å¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¤‡è£½ä¸€æ¬¡ã€‚");
        }
    }

    function render() {
        let list = document.getElementById('list');
        let data = getData();
        list.innerHTML = '';

        if(data.length === 0) {
            list.innerHTML = '<div style="text-align:center;color:#C0B4B8;margin:40px 0;font-weight:700;">ğŸ“­ é€™è£¡ç©ºç©ºçš„<br>å¿«å»ä¸Šé¢æ–°å¢èª²ç¨‹å§ï¼âœ¨</div>';
            return;
        }

        data.forEach(item => {
            let limit = item.limit;
            let total = item.sick + item.mens;
            let max = Math.max(limit*1.3, total*1.1);
            
            // ç³»çµ±ç‹€æ…‹
            let sysSt = item.sick >= limit ? '<span class="badge danger">âŒ æ‰£è€ƒ</span>' : `<span class="badge safe">âœ… å®‰å…¨ (${item.sick}/${limit})</span>`;
            
            // çœŸå¯¦ç‹€æ…‹
            let realSt = "";
            let left = limit - total;
            if(total >= limit) realSt = '<span class="badge danger">ğŸ’¥ æ‰£è€ƒ</span>';
            else if(left <= 2) realSt = `<span class="badge warn">âš ï¸ å‰© ${left} ç¯€</span>`;
            else realSt = `<span class="badge safe">ğŸ’– å‰© ${left} ç¯€</span>`;

            let sPct = (item.sick/max)*100;
            let mPct = (item.mens/max)*100;
            let lPos = (limit/max)*100;
            let sRad = item.mens===0?'rounded':'';
            let mRad = item.sick===0?'rounded':'';

            let html = `
            <div class="course-card">
                <div class="card-header">
                    <div>
                        <div class="c-name">ğŸ“• ${item.name}</div>
                        <div class="c-meta">ç¸½ç¯€æ•¸ ${item.total}ï½œğŸ¯ æ‰£è€ƒç·š ${limit}</div>
                    </div>
                    <button class="btn-del" onclick="del(${item.id})">ğŸ—‘ï¸</button>
                </div>

                <div class="dashboard">
                    <div class="dash-item"><span>ğŸ« ç³»çµ±é¡¯ç¤º</span>${sysSt}</div>
                    <div class="dash-item"><span>ğŸ’£ çœŸå¯¦é¢¨éšª</span>${realSt}</div>
                </div>

                <div class="progress-track">
                    <div class="limit-mark" style="left:${lPos}%"></div>
                    <div class="limit-txt" style="left:${lPos}%">1/3 ç·š</div>
                    <div class="bar-seg b-sick ${sRad}" style="width:${sPct}%"></div>
                    <div class="bar-seg b-mens ${mRad}" style="width:${mPct}%"></div>
                </div>

                <div class="controls">
                    <div class="ctrl-group">
                        <div>
                            <div class="ctrl-label">ğŸ¤’ ç—…å‡</div>
                            <div class="val v-sick">${item.sick}</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <button class="btn-act btn-m" onclick="update(${item.id},'sick',-1)">-</button>
                            <button class="btn-act btn-p" style="color:#C084FC" onclick="update(${item.id},'sick',2)">+2</button>
                        </div>
                    </div>
                    <div class="ctrl-group">
                        <div>
                            <div class="ctrl-label">ğŸŒ¸ ç”Ÿç†å‡</div>
                            <div class="val v-mens">${item.mens}</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <button class="btn-act btn-m" onclick="update(${item.id},'mens',-1)">-</button>
                            <button class="btn-act btn-p" style="color:#FF6B6B" onclick="update(${item.id},'mens',2)">+2</button>
                        </div>
                    </div>
                </div>
            </div>`;
            list.innerHTML += html;
        });
    }
</script>
</body>
</html>
