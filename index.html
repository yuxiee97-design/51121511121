<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…ç´šå¤§é…·ç‚«æ‰£è€ƒç¥å™¨ Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #EEF2F6;
            --surface: #FFFFFF;
            --primary: #4361EE;
            --text-main: #2B2D42;
            --text-sub: #8D99AE;
            --sick-grad: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            --mens-grad: linear-gradient(135deg, #EC4899 0%, #F43F5E 100%);
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app-wrapper { width: 100%; max-width: 500px; padding-bottom: 50px; }

        /* Header */
        header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 26px; font-weight: 900; letter-spacing: -0.5px; }
        p.subtitle { margin: 5px 0 0; font-size: 13px; color: var(--text-sub); }

        /* Add Form */
        .add-card {
            background: var(--surface); padding: 12px; border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; gap: 10px; margin-bottom: 25px;
        }
        input, select { padding: 12px; border: 1px solid #E2E8F0; border-radius: 12px; outline: none; background: #F8FAFC; width: 100%; font-size: 15px; }
        .btn-add {
            background: var(--primary); color: white; border: none; border-radius: 12px;
            width: 50px; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .btn-add:active { transform: scale(0.9); }

        /* Course Card */
        .course-card {
            background: var(--surface); border-radius: 20px; padding: 20px;
            margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); position: relative;
        }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .c-name { font-size: 18px; font-weight: 700; }
        .c-meta { font-size: 12px; color: var(--text-sub); margin-top: 4px; }
        .btn-del { background: none; border: none; color: #ccc; font-size: 20px; cursor: pointer; }
        .btn-del:hover { color: #EF4444; }

        /* Dashboard & Progress */
        .dashboard {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            background: #F8FAFC; padding: 10px; border-radius: 12px; margin-bottom: 20px;
        }
        .dash-item { text-align: center; font-size: 12px; font-weight: 600; display: flex; flex-direction: column; gap: 4px; }
        .badge { padding: 4px 8px; border-radius: 6px; font-weight: 700; }
        .safe { background: #E0FDF4; color: #10B981; }
        .warn { background: #FFFBEB; color: #F59E0B; }
        .danger { background: #FEF2F2; color: #EF4444; }

        .progress-track {
            height: 14px; background: #E2E8F0; border-radius: 7px; position: relative; margin-bottom: 20px;
        }
        .bar-seg { height: 100%; float: left; transition: width 0.3s; position: relative; }
        .b-sick { background: var(--sick-grad); border-radius: 7px 0 0 7px; z-index: 2; }
        .b-mens { background: var(--mens-grad); border-radius: 0 7px 7px 0; z-index: 1; }
        .rounded { border-radius: 7px !important; }

        .limit-mark {
            position: absolute; top: -4px; bottom: -4px; width: 2px; background: #2B2D42; z-index: 10;
        }
        .limit-txt {
            position: absolute; top: -22px; left: 50%; transform: translateX(-50%);
            font-size: 10px; font-weight: 800; background: var(--surface); padding: 2px 5px; border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Controls */
        .controls { display: flex; gap: 10px; }
        .ctrl-group {
            flex: 1; background: #F8FAFC; padding: 8px; border-radius: 12px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid #F1F5F9;
        }
        .val { font-size: 18px; font-weight: 800; }
        .v-sick { color: #6366F1; } .v-mens { color: #EC4899; }
        
        .btn-act {
            border: none; cursor: pointer; font-weight: 700; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; transition: 0.1s;
        }
        .btn-m { background: transparent; color: #aaa; width: 24px; font-size: 18px; }
        .btn-p { background: white; color: #333; width: 34px; height: 34px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn-p:active { transform: scale(0.95); }

        /* Data Sync Section */
        .sync-section {
            margin-top: 40px; padding: 20px; background: #fff; border-radius: 16px; text-align: center;
            border: 2px dashed #E2E8F0;
        }
        .sync-btn {
            background: #333; color: white; border: none; padding: 10px 20px; border-radius: 8px; 
            font-size: 14px; cursor: pointer; margin: 5px; font-weight: 600; transition: 0.2s;
        }
        .sync-btn:active { transform: scale(0.95); }
        .sync-btn.import { background: #4361EE; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <header>
        <h1>è¶…ç´šå¤§é…·ç‚«æ‰£è€ƒç¥å™¨ <span style="color:var(--primary)">Pro</span></h1>
        <p class="subtitle">é›™è»Œåµæ¸¬ï¼ä¸€éµï¼‹2ï¼è·¨è£ç½®è½‰ç§»</p>
    </header>

    <div class="add-card">
        <input type="text" id="name" placeholder="èª²ç¨‹åç¨±" style="flex:2">
        <select id="weekly" style="flex:1">
            <option value="2">2ç¯€/é€±</option>
            <option value="1">1ç¯€/é€±</option>
            <option value="3">3ç¯€/é€±</option>
        </select>
        <button class="btn-add" onclick="add()">+</button>
    </div>

    <div id="list"></div>

    <div class="sync-section">
        <p style="font-size:12px; color:#666; margin-bottom:15px;">
            â˜ï¸ <b>æ›æ‰‹æ©Ÿ/é›»è…¦æ™‚ç”¨é€™å€‹</b><br>
            ä¸åŒè£ç½®è³‡æ–™ä¸äº’é€šï¼Œè«‹æ‰‹å‹•æ¬ç§»ã€‚
        </p>
        <button class="sync-btn" onclick="exportData()">ğŸ“¤ åŒ¯å‡ºè³‡æ–™ (ç”¢ç”Ÿä»£ç¢¼)</button>
        <button class="sync-btn import" onclick="importData()">ğŸ“¥ åŒ¯å…¥è³‡æ–™ (è²¼ä¸Šä»£ç¢¼)</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", render);

    // é€™è£¡æˆ‘å€‘æ²¿ç”¨ä¹‹å‰çš„å„²å­˜åç¨±ï¼Œé€™æ¨£ä½ æ›´æ–°æª”åå¾Œï¼ŒèˆŠè³‡æ–™å¯èƒ½é‚„æœƒåœ¨
    function getData() { return JSON.parse(localStorage.getItem("ck_final")) || []; }
    function saveData(d) { localStorage.setItem("ck_final", JSON.stringify(d)); }

    function add() {
        let name = document.getElementById('name').value.trim();
        let weekly = parseInt(document.getElementById('weekly').value);
        if(!name) return;
        let total = weekly * 18;
        let data = getData();
        data.push({ id: Date.now(), name, total, limit: Math.ceil(total/3), sick:0, mens:0 });
        saveData(data);
        document.getElementById('name').value = '';
        render();
    }

    function update(id, type, val) {
        let data = getData();
        let item = data.find(x => x.id === id);
        if(item) {
            if(type==='sick') item.sick = Math.max(0, item.sick+val);
            if(type==='mens') item.mens = Math.max(0, item.mens+val);
            saveData(data);
            render();
        }
    }

    function del(id) {
        if(confirm("åˆªé™¤æ­¤èª²ç¨‹ï¼Ÿ")) { saveData(getData().filter(x=>x.id!==id)); render(); }
    }

    // --- è½‰ç§»åŠŸèƒ½ ---
    function exportData() {
        let data = localStorage.getItem("ck_final");
        if(!data || data === "[]") return alert("ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡ºå–”ï¼");
        let code = btoa(encodeURIComponent(data));
        navigator.clipboard.writeText(code).then(() => {
            alert("âœ… ä»£ç¢¼å·²è¤‡è£½ï¼\nè«‹è²¼åˆ°å¦ä¸€å°è£ç½®çš„ã€ŒåŒ¯å…¥ã€åŠŸèƒ½ä¸­ã€‚");
        }).catch(() => {
            prompt("è«‹æ‰‹å‹•è¤‡è£½é€™ä¸²ä»£ç¢¼ï¼š", code);
        });
    }

    function importData() {
        let code = prompt("è«‹è²¼ä¸Šä¾†è‡ªå¦ä¸€å°è£ç½®çš„ä»£ç¢¼ï¼š");
        if(!code) return;
        try {
            let json = decodeURIComponent(atob(code));
            if(confirm("âš ï¸ æ³¨æ„ï¼åŒ¯å…¥å°‡æœƒã€Œè¦†è“‹ã€ç›®å‰æ‰‹æ©Ÿä¸Šçš„æ‰€æœ‰ç´€éŒ„ã€‚\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")) {
                localStorage.setItem("ck_final", json);
                render();
                alert("ğŸ‰ è³‡æ–™è½‰ç§»æˆåŠŸï¼");
            }
        } catch(e) {
            alert("âŒ ä»£ç¢¼æ ¼å¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¤‡è£½ä¸€æ¬¡ã€‚");
        }
    }

    function render() {
        let list = document.getElementById('list');
        let data = getData();
        list.innerHTML = '';

        if(data.length === 0) {
            list.innerHTML = '<div style="text-align:center;color:#ccc;margin:30px;">å°šç„¡ç´€éŒ„</div>';
            return;
        }

        data.forEach(item => {
            let limit = item.limit;
            let total = item.sick + item.mens;
            let max = Math.max(limit*1.3, total*1.1);
            
            // ç³»çµ±ç‹€æ…‹
            let sysSt = item.sick >= limit ? '<span class="badge danger">æ‰£è€ƒ</span>' : `<span class="badge safe">å®‰å…¨ ${item.sick}/${limit}</span>`;
            
            // çœŸå¯¦ç‹€æ…‹
            let realSt = "";
            let left = limit - total;
            if(total >= limit) realSt = '<span class="badge danger">âš ï¸ æ‰£è€ƒ</span>';
            else if(left <= 2) realSt = `<span class="badge warn">å‰© ${left} ç¯€</span>`;
            else realSt = `<span class="badge safe">å‰© ${left} ç¯€</span>`;

            let sPct = (item.sick/max)*100;
            let mPct = (item.mens/max)*100;
            let lPos = (limit/max)*100;
            let sRad = item.mens===0?'rounded':'';
            let mRad = item.sick===0?'rounded':'';

            let html = `
            <div class="course-card">
                <div class="card-header">
                    <div>
                        <div class="c-name">${item.name}</div>
                        <div class="c-meta">ç¸½ç¯€æ•¸ ${item.total}ï½œæ‰£è€ƒç·š ${limit}</div>
                    </div>
                    <button class="btn-del" onclick="del(${item.id})">Ã—</button>
                </div>

                <div class="dashboard">
                    <div class="dash-item"><span style="color:#888">ç³»çµ±é¡¯ç¤º</span>${sysSt}</div>
                    <div class="dash-item"><span style="color:#888">çœŸå¯¦é¢¨éšª</span>${realSt}</div>
                </div>

                <div class="progress-track">
                    <div class="limit-mark" style="left:${lPos}%"></div>
                    <div class="limit-txt" style="left:${lPos}%">1/3</div>
                    <div class="bar-seg b-sick ${sRad}" style="width:${sPct}%"></div>
                    <div class="bar-seg b-mens ${mRad}" style="width:${mPct}%"></div>
                </div>

                <div class="controls">
                    <div class="ctrl-group">
                        <div class="val v-sick">${item.sick}</div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <button class="btn-act btn-m" onclick="update(${item.id},'sick',-1)">-</button>
                            <button class="btn-act btn-p" style="color:#6366F1" onclick="update(${item.id},'sick',2)">+2</button>
                        </div>
                    </div>
                    <div class="ctrl-group">
                        <div class="val v-mens">${item.mens}</div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <button class="btn-act btn-m" onclick="update(${item.id},'mens',-1)">-</button>
                            <button class="btn-act btn-p" style="color:#EC4899" onclick="update(${item.id},'mens',2)">+2</button>
                        </div>
                    </div>
                </div>
            </div>`;
            list.innerHTML += html;
        });
    }
</script>
</body>
</html>
