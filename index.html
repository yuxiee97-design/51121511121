<!DOCTYPE html>
<html lang="zh-TW" data-theme="pink">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…ç´šæ‰£è€ƒç¥å™¨ Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- ä¸»é¡Œè®Šæ•¸å®šç¾© --- */
        :root {
            --radius: 20px;
            --transition: 0.3s ease;
        }

        /* ğŸŒ¸ ç”œå¿ƒç²‰ (é è¨­) */
        [data-theme="pink"] {
            --bg: #FFF5F7;
            --surface: #FFFFFF;
            --surface-sub: #FFFBFC;
            --primary: #FF9EB5;
            --primary-dark: #FF7596;
            --text-main: #665A5D;
            --text-sub: #B0A6A9;
            --border: #F3EFF1;
            --shadow-color: 255, 158, 181;
            --input-bg: #FFFBFC;
            --sick-grad: linear-gradient(135deg, #DDD6FE 0%, #C4B5FD 100%);
            --mens-grad: linear-gradient(135deg, #FECDD3 0%, #FDA4AF 100%);
        }

        /* ğŸ”® é­”å¹»ç´« */
        [data-theme="purple"] {
            --bg: #F5F3FF;
            --surface: #FFFFFF;
            --surface-sub: #FAFAFF;
            --primary: #C4B5FD;
            --primary-dark: #8B5CF6;
            --text-main: #4C1D95;
            --text-sub: #9CA3AF;
            --border: #EDE9FE;
            --shadow-color: 139, 92, 246;
            --input-bg: #FAFAFF;
            --sick-grad: linear-gradient(135deg, #A78BFA 0%, #7C3AED 100%);
            --mens-grad: linear-gradient(135deg, #F472B6 0%, #DB2777 100%);
        }

        /* â„ï¸ å¤©ç©ºè— */
        [data-theme="blue"] {
            --bg: #F0F9FF;
            --surface: #FFFFFF;
            --surface-sub: #F7FBFF;
            --primary: #7DD3FC;
            --primary-dark: #0EA5E9;
            --text-main: #0C4A6E;
            --text-sub: #94A3B8;
            --border: #E0F2FE;
            --shadow-color: 14, 165, 233;
            --input-bg: #F7FBFF;
            --sick-grad: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%);
            --mens-grad: linear-gradient(135deg, #2DD4BF 0%, #0D9488 100%); /* è—ç¶ è‰² */
        }

        /* ğŸ˜ é…·å¸¥é»‘ (Dark Mode) */
        [data-theme="black"] {
            --bg: #121212;
            --surface: #1E1E1E;
            --surface-sub: #252525;
            --primary: #444444;
            --primary-dark: #FFFFFF; /* åœ¨é»‘åº•ä¸­ï¼Œäº®è‰²æ˜¯å¼·èª¿ */
            --text-main: #E0E0E0;
            --text-sub: #888888;
            --border: #333333;
            --shadow-color: 0, 0, 0;
            --input-bg: #2C2C2C;
            --sick-grad: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
            --mens-grad: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
        }

        /* --- ç‹€æ…‹è‰² (å…±ç”¨) --- */
        [data-theme="black"] .safe { background: #064E3B; color: #6EE7B7; }
        [data-theme="black"] .warn { background: #451A03; color: #FCD34D; }
        [data-theme="black"] .danger { background: #450A0A; color: #FCA5A5; }
        [data-theme="black"] .course-card { box-shadow: none; border: 1px solid #333; }
        [data-theme="black"] .add-card { box-shadow: none; border: 1px solid #333; }
        [data-theme="black"] .dashboard { background: #252525; border-color: #333; }
        [data-theme="black"] .ctrl-group { background: #252525; border-color: #333; }
        [data-theme="black"] .limit-txt { background: #333; color: #fff; }
        [data-theme="black"] .limit-mark { background: #fff; border-color: #333; }
        [data-theme="black"] .progress-track { background: #333; }
        [data-theme="black"] .btn-p { background: #333; border-color: #444; color: #fff; }

        /* ä¸€èˆ¬äº®è‰²æ¨¡å¼çš„ç‹€æ…‹è‰² */
        :not([data-theme="black"]) .safe { background: #E3FBF5; color: #059669; }
        :not([data-theme="black"]) .warn { background: #FFF8E1; color: #D97706; }
        :not([data-theme="black"]) .danger { background: #FFF0F0; color: #E11D48; }

        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            transition: background-color var(--transition), color var(--transition);
        }

        .app-wrapper { width: 100%; max-width: 500px; padding-bottom: 50px; }

        /* Theme Switcher */
        .theme-switcher {
            display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;
        }
        .theme-btn {
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
            border: 2px solid rgba(0,0,0,0.1); transition: transform 0.2s;
            position: relative;
        }
        .theme-btn:hover { transform: scale(1.2); }
        .theme-btn.active { border: 2px solid var(--text-main); transform: scale(1.1); }
        
        .t-pink { background: #FF9EB5; }
        .t-purple { background: #C4B5FD; }
        .t-blue { background: #7DD3FC; }
        .t-black { background: #333333; }

        /* Header */
        header { text-align: center; margin-bottom: 35px; }
        h1 { 
            margin: 0; font-size: 26px; font-weight: 700; letter-spacing: 1px; color: var(--primary-dark);
            white-space: nowrap; /* å¼·åˆ¶ä¸æ›è¡Œ */
        }
        
        p.subtitle { 
            margin: 10px 0 0; font-size: 14px; font-weight: 500; color: var(--primary-dark);
            background: var(--surface); display: inline-block; padding: 6px 16px; border-radius: 50px;
            box-shadow: 0 4px 12px rgba(var(--shadow-color), 0.1); letter-spacing: 0.5px;
            border: 1px solid var(--border);
        }

        /* Add Form */
        .add-card {
            background: var(--surface); padding: 15px; border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(var(--shadow-color), 0.15); 
            display: flex; gap: 10px; margin-bottom: 25px;
            border: 1px solid var(--border);
            transition: background var(--transition);
        }
        input, select { 
            padding: 12px 16px; border: 1px solid var(--border); border-radius: 14px; 
            outline: none; background: var(--input-bg); width: 100%; font-size: 15px; color: var(--text-main);
            transition: 0.2s; font-family: 'Noto Sans TC', sans-serif; font-weight: 400;
        }
        input:focus, select:focus { border-color: var(--primary-dark); }
        
        .btn-add {
            background: var(--primary-dark); color: white; border: none; border-radius: 14px;
            width: 50px; font-size: 22px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .btn-add:hover { transform: translateY(-2px); opacity: 0.9; }
        .btn-add:active { transform: scale(0.95); }

        /* Course Card */
        .course-card {
            background: var(--surface); border-radius: 24px; padding: 24px;
            margin-bottom: 24px; box-shadow: 0 8px 25px rgba(var(--shadow-color), 0.08); position: relative;
            border: 1px solid var(--border);
            transition: background var(--transition);
        }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        
        .c-name { font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 8px; letter-spacing: 0.5px; color: var(--text-main); }
        .c-meta { font-size: 13px; color: var(--text-sub); margin-top: 5px; margin-left: 32px; font-weight: 400; }
        
        .btn-del { background: none; border: none; color: var(--text-sub); font-size: 20px; cursor: pointer; transition: 0.2s; }
        .btn-del:hover { color: #E11D48; transform: scale(1.1); }

        /* Dashboard */
        .dashboard {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            background: var(--surface-sub); padding: 12px; border-radius: 18px; margin-bottom: 24px;
            border: 1px solid var(--border);
        }
        .dash-item { 
            text-align: center; font-size: 12px; font-weight: 500; 
            display: flex; flex-direction: column; gap: 8px; color: var(--text-sub); 
        }
        .badge { 
            padding: 8px 12px; border-radius: 12px; font-weight: 700; font-size: 14px; 
            display: flex; align-items: center; justify-content: center; gap: 4px;
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
        }

        /* Progress Bar */
        .progress-track {
            height: 14px; background: #F3EFF1; border-radius: 7px; position: relative; margin-bottom: 24px;
        }
        .bar-seg { height: 100%; float: left; transition: width 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; }
        .b-sick { background: var(--sick-grad); border-radius: 7px 0 0 7px; z-index: 2; }
        .b-mens { background: var(--mens-grad); border-radius: 0 7px 7px 0; z-index: 1; }
        .rounded { border-radius: 7px !important; }

        .limit-mark {
            position: absolute; top: -5px; bottom: -5px; width: 2px; background: var(--text-main); z-index: 10;
            border-radius: 2px; border: 2px solid var(--surface);
        }
        .limit-txt {
            position: absolute; top: -26px; left: 50%; transform: translateX(-50%);
            font-size: 11px; font-weight: 700; background: var(--surface); padding: 2px 8px; border-radius: 6px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.06); color: var(--primary-dark);
            font-family: 'Nunito', sans-serif;
        }

        /* Controls */
        .controls { display: flex; gap: 12px; }
        .ctrl-group {
            flex: 1; background: var(--surface-sub); padding: 10px 14px; border-radius: 18px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);
        }
        .ctrl-label { font-size: 12px; font-weight: 500; color: var(--text-sub); display: flex; align-items: center; gap: 4px; }
        .val { font-size: 22px; font-weight: 800; font-family: 'Nunito', sans-serif; }
        .v-sick { color: #A78BFA; } .v-mens { color: #FB7185; }
        
        .btn-act {
            border: none; cursor: pointer; font-weight: 700; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
            font-family: 'Nunito', sans-serif;
        }
        .btn-m { background: transparent; color: var(--text-sub); width: 28px; font-size: 20px; }
        .btn-m:hover { color: var(--primary-dark); }
        .btn-p { 
            background: var(--surface); color: var(--text-main); width: 36px; height: 36px; 
            border: 1px solid var(--border); box-shadow: 0 3px 6px rgba(0,0,0,0.03); font-size: 14px; 
        }
        .btn-p:hover { border-color: var(--primary-dark); color: var(--primary-dark); transform: translateY(-2px); }
        .btn-p:active { transform: scale(0.95); }

        /* Data Sync Section */
        .sync-section {
            margin-top: 40px; padding: 25px; background: var(--surface); border-radius: 24px; text-align: center;
            border: 1px dashed var(--primary-dark);
        }
        .sync-btn {
            background: var(--text-main); color: var(--surface); border: none; padding: 10px 22px; border-radius: 12px; 
            font-size: 14px; cursor: pointer; margin: 8px; font-weight: 600; transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: inline-flex; align-items: center; gap: 8px;
        }
        .sync-btn.import { background: var(--primary-dark); }
    </style>
</head>
<body>

<div class="app-wrapper">
    <div class="theme-switcher">
        <div class="theme-btn t-pink active" onclick="setTheme('pink')" title="ç”œå¿ƒç²‰"></div>
        <div class="theme-btn t-purple" onclick="setTheme('purple')" title="é­”å¹»ç´«"></div>
        <div class="theme-btn t-blue" onclick="setTheme('blue')" title="å¤©ç©ºè—"></div>
        <div class="theme-btn t-black" onclick="setTheme('black')" title="é…·å¸¥é»‘"></div>
    </div>

    <header>
        <h1>âœ¨ è¶…ç´šæ‰£è€ƒç¥å™¨ <span style="color:var(--primary-dark)">Pro</span></h1>
        <p class="subtitle">ğŸ¥º æˆ‘ä¸è¦æ‰£è€ƒ ğŸ¥º</p>
    </header>

    <div class="add-card">
        <input type="text" id="name" placeholder="ğŸ“ è¼¸å…¥èª²ç¨‹åç¨±..." style="flex:2">
        <select id="weekly" style="flex:1">
            <option value="1">ğŸ“… 1ç¯€</option>
            <option value="2" selected>ğŸ“… 2ç¯€</option>
            <option value="3">ğŸ“… 3ç¯€</option>
            <option value="4">ğŸ“… 4ç¯€</option>
        </select>
        <button class="btn-add" onclick="add()">ï¼‹</button>
    </div>

    <div id="list"></div>

    <div class="sync-section">
        <h3 style="margin:0 0 10px 0; color:var(--primary-dark); font-weight:700; font-size:16px;">â˜ï¸ è·¨è£ç½®é›²ç«¯å‚³é€é–€</h3>
        <p style="font-size:13px; color:var(--text-sub); margin-bottom:20px; font-weight:400;">
            æ›æ‰‹æ©Ÿäº†å—ï¼Ÿç”¨é€™è£¡æŠŠè³‡æ–™æ‰“åŒ…å¸¶èµ°ï¼ğŸ“¦<br>
            (ä¸åŒè£ç½®è³‡æ–™ä¸äº’é€šå–”)
        </p>
        <button class="sync-btn" onclick="exportData()">ğŸ“¤ æ‰“åŒ…è³‡æ–™</button>
        <button class="sync-btn import" onclick="importData()">ğŸ“¥ è§£å£“ç¸®</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        loadTheme();
        render();
    });

    // --- ä¸»é¡ŒåŠŸèƒ½ ---
    function setTheme(themeName) {
        document.documentElement.setAttribute('data-theme', themeName);
        localStorage.setItem('ck_theme', themeName);
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.classList.contains('t-' + themeName)) btn.classList.add('active');
        });
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('ck_theme') || 'pink';
        setTheme(savedTheme);
    }

    // --- è³‡æ–™åŠŸèƒ½ (ä¿æŒä¸è®Š) ---
    function getData() { return JSON.parse(localStorage.getItem("ck_final")) || []; }
    function saveData(d) { localStorage.setItem("ck_final", JSON.stringify(d)); }

    function add() {
        let name = document.getElementById('name').value.trim();
        let weekly = parseInt(document.getElementById('weekly').value);
        if(!name) return;
        let total = weekly * 18;
        let data = getData();
        data.push({ id: Date.now(), name, total, limit: Math.ceil(total/3), sick:0, mens:0 });
        saveData(data);
        document.getElementById('name').value = '';
        render();
    }

    function update(id, type, val) {
        let data = getData();
        let item = data.find(x => x.id === id);
        if(item) {
            if(type==='sick') item.sick = Math.max(0, item.sick+val);
            if(type==='mens') item.mens = Math.max(0, item.mens+val);
            saveData(data);
            render();
        }
    }

    function del(id) {
        if(confirm("ğŸ—‘ï¸ ç¢ºå®šè¦åˆªé™¤é€™å ‚èª²çš„ç´€éŒ„å—ï¼Ÿ")) { saveData(getData().filter(x=>x.id!==id)); render(); }
    }

    function exportData() {
        let data = localStorage.getItem("ck_final");
        if(!data || data === "[]") return alert("ğŸ“­ ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥æ‰“åŒ…å–”ï¼");
        let code = btoa(encodeURIComponent(data));
        navigator.clipboard.writeText(code).then(() => {
            alert("âœ… ä»£ç¢¼å·²è¤‡è£½ï¼\nè«‹è²¼åˆ°å¦ä¸€å°è£ç½®çš„ã€ŒğŸ“¥ è§£å£“ç¸®ã€è£¡ã€‚");
        }).catch(() => {
            prompt("ğŸ‘‡ è«‹æ‰‹å‹•è¤‡è£½é€™ä¸²ä»£ç¢¼ ğŸ‘‡", code);
        });
    }

    function importData() {
        let code = prompt("ğŸ‘‡ è«‹è²¼ä¸Šä¾†è‡ªå¦ä¸€å°è£ç½®çš„ä»£ç¢¼ ğŸ‘‡");
        if(!code) return;
        try {
            let json = decodeURIComponent(atob(code));
            if(confirm("âš ï¸ æ³¨æ„ï¼\nåŒ¯å…¥å°‡æœƒã€Œè¦†è“‹ã€ç›®å‰æ‰‹æ©Ÿä¸Šçš„æ‰€æœ‰ç´€éŒ„ã€‚\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")) {
                localStorage.setItem("ck_final", json);
                render();
                alert("ğŸ‰ æˆåŠŸï¼è³‡æ–™è½‰ç§»å®Œæˆï¼");
            }
        } catch(e) {
            alert("âŒ ä»£ç¢¼æ ¼å¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¤‡è£½ä¸€æ¬¡ã€‚");
        }
    }

    function render() {
        let list = document.getElementById('list');
        let data = getData();
        list.innerHTML = '';

        if(data.length === 0) {
            list.innerHTML = '<div style="text-align:center;color:var(--text-sub);margin:40px 0;font-weight:400;font-size:14px;">ğŸ“­ é€™è£¡ç©ºç©ºçš„<br>å¿«å»ä¸Šé¢æ–°å¢èª²ç¨‹å§ï¼âœ¨</div>';
            return;
        }

        data.forEach(item => {
            let limit = item.limit;
            let total = item.sick + item.mens;
            let max = Math.max(limit*1.3, total*1.1);
            
            // ç³»çµ±ç‹€æ…‹
            let sysSt = item.sick >= limit ? '<span class="badge danger">âŒ æ‰£è€ƒ</span>' : `<span class="badge safe">âœ… å®‰å…¨ (${item.sick}/${limit})</span>`;
            
            // çœŸå¯¦ç‹€æ…‹
            let realSt = "";
            let left = limit - total;
            if(total >= limit) realSt = '<span class="badge danger">ğŸ’¥ æ‰£è€ƒ</span>';
            else if(left <= 2) realSt = `<span class="badge warn">âš ï¸ å‰© ${left} ç¯€</span>`;
            else realSt = `<span class="badge safe">ğŸ’– å‰© ${left} ç¯€</span>`;

            let sPct = (item.sick/max)*100;
            let mPct = (item.mens/max)*100;
            let lPos = (limit/max)*100;
            let sRad = item.mens===0?'rounded':'';
            let mRad = item.sick===0?'rounded':'';

            let html = `
            <div class="course-card">
                <div class="card-header">
                    <div>
                        <div class="c-name">ğŸ“• ${item.name}</div>
                        <div class="c-meta">ç¸½ç¯€æ•¸ ${item.total}ï½œğŸ¯ æ‰£è€ƒç·š ${limit}</div>
                    </div>
                    <button class="btn-del" onclick="del(${item.id})">ğŸ—‘ï¸</button>
                </div>

                <div class="dashboard">
                    <div class="dash-item"><span>ğŸ« ç³»çµ±é¡¯ç¤º</span>${sysSt}</div>
                    <div class="dash-item"><span>ğŸ’£ çœŸå¯¦é¢¨éšª</span>${realSt}</div>
                </div>

                <div class="progress-track">
                    <div class="limit-mark" style="left:${lPos}%"></div>
                    <div class="limit-txt" style="left:${lPos}%">1/3 ç·š</div>
                    <div class="bar-seg b-sick ${sRad}" style="width:${sPct}%"></div>
                    <div class="bar-seg b-mens ${mRad}" style="width:${mPct}%"></div>
                </div>

                <div class="controls">
                    <div class="ctrl-group">
                        <div>
                            <div class="ctrl-label">ğŸ¤’ ç—…å‡</div>
                            <div class="val v-sick">${item.sick}</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <button class="btn-act btn-m" onclick="update(${item.id},'sick',-1)">-</button>
                            <button class="btn-act btn-p" style="color:var(--text-main)" onclick="update(${item.id},'sick',2)">+2</button>
                        </div>
                    </div>
                    <div class="ctrl-group">
                        <div>
                            <div class="ctrl-label">ğŸŒ¸ ç”Ÿç†å‡</div>
                            <div class="val v-mens">${item.mens}</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <button class="btn-act btn-m" onclick="update(${item.id},'mens',-1)">-</button>
                            <button class="btn-act btn-p" style="color:var(--text-main)" onclick="update(${item.id},'mens',2)">+2</button>
                        </div>
                    </div>
                </div>
            </div>`;
            list.innerHTML += html;
        });
    }
</script>
</body>
</html>
